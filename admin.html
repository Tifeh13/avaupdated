<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ava Admin â€” Command Center</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300&family=DM+Mono:wght@300;400;500&family=Montserrat:wght@200;300;400;500;600&display=swap" rel="stylesheet">
<style>
:root{--gold:#D4AF37;--gold-dim:rgba(212,175,55,.18);--gold-glow:rgba(212,175,55,.3);--black:#060606;--surface:#0e0e0e;--panel:#131313;--raised:#191919;--border:rgba(212,175,55,.1);--border-bright:rgba(212,175,55,.35);--white:#F0EBE0;--muted:rgba(240,235,224,.5);--faint:rgba(240,235,224,.2);--green:#2ecc71;--red:#e74c3c;--blue:#3498db;--orange:#f39c12;--mono:'DM Mono',monospace;--serif:'Cormorant Garamond',serif;--sans:'Montserrat',sans-serif;--sidebar:220px;--topbar:58px}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{background:var(--black);color:var(--white);font-family:var(--sans);font-size:13px}
a{text-decoration:none;color:inherit}
button,input,select,textarea{font-family:var(--sans)}
button{cursor:pointer}
input,select,textarea{outline:none}
img{display:block}
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border-bright);border-radius:2px}

/* LOGIN */
.login-screen{position:fixed;inset:0;background:var(--black);display:flex;align-items:center;justify-content:center;z-index:9999;background-image:radial-gradient(ellipse at 30% 50%,rgba(212,175,55,.04) 0%,transparent 60%),radial-gradient(ellipse at 70% 20%,rgba(212,175,55,.03) 0%,transparent 50%)}
.login-box{width:min(400px,92vw);padding:3.5rem;border:1px solid var(--border);background:var(--surface);position:relative;overflow:hidden}
.login-box::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent)}
.login-logo{font-family:var(--serif);font-size:2.2rem;font-weight:300;letter-spacing:.4em;color:var(--gold);margin-bottom:.3rem}
.login-sub{font-size:.58rem;letter-spacing:.4em;text-transform:uppercase;color:var(--muted);margin-bottom:3rem;font-family:var(--mono)}
.login-label{font-size:.58rem;letter-spacing:.3em;text-transform:uppercase;color:var(--muted);display:block;margin-bottom:.6rem}
.login-input{width:100%;background:var(--panel);border:1px solid var(--border);color:var(--white);padding:.9rem 1.2rem;font-family:var(--mono);font-size:.85rem;letter-spacing:.1em;transition:border-color .3s;margin-bottom:1.5rem}
.login-input:focus{border-color:var(--gold)}
.login-btn{width:100%;background:var(--gold);color:var(--black);border:none;padding:1rem;font-size:.65rem;letter-spacing:.35em;text-transform:uppercase;font-weight:600;transition:all .3s}
.login-btn:hover{background:#e5bf40}
.login-err{color:var(--red);font-size:.6rem;letter-spacing:.1em;margin-top:.8rem;display:none;font-family:var(--mono)}
.login-err.show{display:block}
.login-hint{font-size:.55rem;color:var(--faint);margin-top:2rem;font-family:var(--mono);letter-spacing:.08em}

/* APP SHELL */
.app{display:none;height:100vh;overflow:hidden}
.app.visible{display:flex}

/* SIDEBAR */
.sidebar{width:var(--sidebar);flex-shrink:0;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;height:100vh;overflow:hidden}
.s-brand{padding:1.5rem 1.4rem 1.2rem;border-bottom:1px solid var(--border);flex-shrink:0}
.s-logo{font-family:var(--serif);font-size:1.5rem;font-weight:300;letter-spacing:.35em;color:var(--gold);line-height:1}
.s-logo-sub{font-size:.45rem;letter-spacing:.5em;text-transform:uppercase;color:var(--faint);font-family:var(--mono);margin-top:.2rem}
.s-badge{font-size:.48rem;letter-spacing:.2em;background:rgba(212,175,55,.12);color:var(--gold);border:1px solid var(--gold-dim);padding:.2rem .6rem;display:inline-block;margin-top:.8rem}
.s-nav{flex:1;overflow-y:auto;padding:1rem 0}
.s-section{font-size:.48rem;letter-spacing:.4em;text-transform:uppercase;color:var(--faint);font-family:var(--mono);padding:.8rem 1.4rem .4rem}
.s-item{display:flex;align-items:center;gap:.8rem;padding:.7rem 1.4rem;font-size:.65rem;letter-spacing:.08em;color:var(--muted);transition:all .25s;border-left:2px solid transparent;cursor:pointer;-webkit-tap-highlight-color:transparent;min-height:44px}
.s-item:hover{color:var(--white);background:rgba(255,255,255,.02)}
.s-item.active{color:var(--gold);border-left-color:var(--gold);background:var(--gold-dim)}
.s-item .ic{font-size:1rem;width:20px;text-align:center;flex-shrink:0}
.s-item .badge-ct{margin-left:auto;background:var(--gold);color:var(--black);font-size:.48rem;font-weight:700;padding:.15rem .5rem;border-radius:10px}
.s-foot{border-top:1px solid var(--border);padding:1rem 1.4rem;display:flex;align-items:center;gap:.8rem}
.s-avatar{width:30px;height:30px;background:var(--gold-dim);border:1px solid var(--border-bright);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.7rem;color:var(--gold);flex-shrink:0}
.s-user{font-size:.6rem;color:var(--muted)}
.s-user strong{display:block;color:var(--white);font-size:.65rem;font-weight:500}
.s-logout{margin-left:auto;background:none;border:none;color:var(--faint);font-size:.75rem;transition:color .2s;min-width:44px;min-height:44px}
.s-logout:hover{color:var(--red)}

/* MAIN */
.main{flex:1;display:flex;flex-direction:column;overflow:hidden}
.topbar{height:var(--topbar);flex-shrink:0;background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 2rem;gap:1.5rem}
.topbar-title{font-family:var(--serif);font-size:1.1rem;font-weight:300;letter-spacing:.05em}
.topbar-title span{color:var(--gold);font-style:italic}
.topbar-r{margin-left:auto;display:flex;align-items:center;gap:1rem}
.topbar-time{font-family:var(--mono);font-size:.65rem;color:var(--muted)}
.topbar-link{font-size:.6rem;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);border:1px solid var(--border);padding:.35rem .9rem;transition:all .2s}
.topbar-link:hover{border-color:var(--gold);color:var(--gold)}
.content{flex:1;overflow-y:auto;padding:2rem}

/* PANELS */
.panel{display:none}
.panel.active{display:block}

/* CARDS & STATS */
.stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:2rem}
.stat-card{background:var(--panel);border:1px solid var(--border);padding:1.5rem;position:relative;overflow:hidden;transition:border-color .3s}
.stat-card:hover{border-color:var(--border-bright)}
.stat-card::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px}
.stat-card.gold::after{background:var(--gold)}
.stat-card.green::after{background:var(--green)}
.stat-card.blue::after{background:var(--blue)}
.stat-card.orange::after{background:var(--orange)}
.stat-label{font-size:.55rem;letter-spacing:.3em;text-transform:uppercase;color:var(--muted);font-family:var(--mono);margin-bottom:.7rem}
.stat-val{font-family:var(--serif);font-size:2rem;font-weight:300;color:var(--white);line-height:1;margin-bottom:.4rem}
.stat-val span{font-size:1rem;color:var(--gold)}
.stat-delta{font-size:.58rem;font-family:var(--mono)}
.stat-delta.up{color:var(--green)}
.stat-delta.dn{color:var(--red)}
.dash-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}
.card{background:var(--panel);border:1px solid var(--border)}
.card-head{padding:1.2rem 1.5rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.card-title{font-size:.58rem;letter-spacing:.35em;text-transform:uppercase;color:var(--gold);font-family:var(--mono)}
.card-body{padding:1.5rem}
.chart-area{height:160px;position:relative;display:flex;align-items:flex-end;gap:6px}
.bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;gap:.5rem}
.bar{width:100%;border-radius:1px 1px 0 0;transition:height .6s cubic-bezier(.4,0,.2,1);position:relative;cursor:pointer}
.bar:hover::after{content:attr(data-tip);position:absolute;top:-28px;left:50%;transform:translateX(-50%);background:var(--raised);border:1px solid var(--border-bright);font-size:.55rem;color:var(--white);padding:.2rem .5rem;white-space:nowrap;font-family:var(--mono);pointer-events:none}
.bar-lbl{font-size:.48rem;font-family:var(--mono);color:var(--faint);letter-spacing:.08em}
.cat-row{display:flex;align-items:center;gap:1rem;padding:.65rem 0;border-bottom:1px solid rgba(212,175,55,.05)}
.cat-row:last-child{border-bottom:none}
.cat-name{font-size:.65rem;color:var(--muted);width:80px;flex-shrink:0}
.cat-bar-wrap{flex:1;height:4px;background:rgba(255,255,255,.05);border-radius:2px;overflow:hidden}
.cat-bar{height:100%;background:var(--gold);border-radius:2px;transition:width .8s cubic-bezier(.4,0,.2,1)}
.cat-pct{font-family:var(--mono);font-size:.58rem;color:var(--gold);width:35px;text-align:right;flex-shrink:0}
.recent-row{display:flex;align-items:center;gap:1rem;padding:.7rem 0;border-bottom:1px solid rgba(212,175,55,.05)}
.recent-row:last-child{border-bottom:none}
.r-img{width:38px;height:38px;flex-shrink:0;object-fit:cover;border:1px solid var(--border)}
.r-name{flex:1;font-size:.68rem;color:var(--white)}
.r-cat{font-size:.55rem;color:var(--muted);font-family:var(--mono);margin-top:.15rem}
.r-price{font-family:var(--serif);font-size:1rem;color:var(--gold)}
.activity-row{display:flex;align-items:center;gap:.8rem;padding:.55rem 0}
.activity-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.activity-txt{font-size:.63rem;color:var(--muted);flex:1}
.activity-txt strong{color:var(--white)}
.activity-time{font-family:var(--mono);font-size:.52rem;color:var(--faint)}

/* PRODUCTS */
.prod-toolbar{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}
.search-input{flex:1;background:var(--panel);border:1px solid var(--border);color:var(--white);padding:.6rem 1rem;font-size:.7rem;font-family:var(--mono);min-width:200px;transition:border-color .3s}
.search-input:focus{border-color:var(--gold)}
.search-input::placeholder{color:var(--faint)}
.sel{background:var(--panel);border:1px solid var(--border);color:var(--white);padding:.6rem .9rem;font-size:.65rem;font-family:var(--mono);cursor:pointer}
.sel:focus{border-color:var(--gold)}
.btn{padding:.6rem 1.4rem;font-size:.6rem;letter-spacing:.2em;text-transform:uppercase;font-weight:600;border:none;transition:all .25s;cursor:pointer;display:inline-flex;align-items:center;gap:.5rem;min-height:44px;-webkit-tap-highlight-color:transparent}
.btn-gold{background:var(--gold);color:var(--black)}
.btn-gold:hover{background:#e5bf40;transform:translateY(-1px)}
.btn-outline{background:transparent;border:1px solid var(--border);color:var(--muted)}
.btn-outline:hover{border-color:var(--gold);color:var(--gold)}
.btn-red{background:rgba(231,76,60,.15);border:1px solid rgba(231,76,60,.3);color:var(--red)}
.btn-red:hover{background:rgba(231,76,60,.25)}
.btn-sm{padding:.4rem .9rem;font-size:.55rem;min-height:36px}

/* PM SPLIT */
.pm-split{display:grid;grid-template-columns:1fr 360px;gap:1.5rem;align-items:start}
.pm-list{min-width:0}
.pm-cards{display:flex;flex-direction:column;gap:.6rem;max-height:calc(100vh - 260px);overflow-y:auto;padding-right:.3rem}
.pm-card{display:flex;align-items:center;gap:.9rem;background:var(--panel);border:1px solid var(--border);padding:.8rem 1rem;cursor:pointer;transition:all .2s}
.pm-card:hover{border-color:var(--border-bright);background:var(--raised)}
.pm-card.selected{border-color:var(--gold);background:var(--gold-dim)}
.pm-card-img{width:52px;height:52px;object-fit:cover;border:1px solid var(--border);flex-shrink:0}
.pm-card-info{flex:1;min-width:0}
.pm-card-name{font-size:.72rem;color:var(--white);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:.2rem}
.pm-card-sub{font-size:.55rem;color:var(--muted);font-family:var(--mono)}
.pm-card-price{font-family:var(--serif);font-size:1rem;color:var(--gold);flex-shrink:0}
.pm-card-del{background:none;border:none;color:var(--faint);font-size:.8rem;padding:.2rem .4rem;transition:color .2s;flex-shrink:0;min-width:36px;min-height:36px}
.pm-card-del:hover{color:var(--red)}
.pm-form-wrap{background:var(--panel);border:1px solid var(--border);position:sticky;top:calc(var(--topbar) + 1rem);max-height:calc(100vh - 100px);overflow-y:auto}
.pm-form-head{padding:1rem 1.2rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:var(--surface);position:sticky;top:0;z-index:2}
.pm-form-title{font-size:.65rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);font-family:var(--mono)}
.pm-form-reset{font-size:.55rem;letter-spacing:.15em;text-transform:uppercase;background:none;border:1px solid var(--border);color:var(--muted);padding:.3rem .7rem;transition:all .2s;min-height:36px}
.pm-form-reset:hover{border-color:var(--gold);color:var(--gold)}
.pm-form-body{padding:1.2rem}
.pm-add-new{display:flex;align-items:center;justify-content:center;gap:.5rem;border:1px dashed var(--border-bright);color:var(--gold);font-size:.6rem;letter-spacing:.25em;text-transform:uppercase;padding:.8rem;cursor:pointer;transition:all .2s;background:transparent;width:100%;margin-bottom:.8rem;font-family:var(--sans);min-height:44px}
.pm-add-new:hover{background:var(--gold-dim);border-style:solid}

/* FIELD */
.field{display:flex;flex-direction:column;gap:.5rem}
.field label{font-size:.55rem;letter-spacing:.3em;text-transform:uppercase;color:var(--muted);font-family:var(--mono)}
.field input,.field select{background:var(--raised);border:1px solid var(--border);color:var(--white);padding:.7rem 1rem;font-size:.72rem;font-family:var(--sans);transition:border-color .3s}
.field input:focus,.field select:focus{border-color:var(--gold)}
.field select option{background:var(--raised)}
.img-preview{width:100%;height:160px;object-fit:cover;border:1px solid var(--border);margin-top:.5rem;display:none}
.img-preview.show{display:block}
.drop-zone{border:1px dashed var(--border-bright);padding:2rem;text-align:center;cursor:pointer;transition:all .3s;position:relative}
.drop-zone:hover{border-color:var(--gold);background:var(--gold-dim)}
.drop-zone input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer}

/* IMAGE LIBRARY */
.img-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:1rem}
.img-card{background:var(--panel);border:1px solid var(--border);overflow:hidden;transition:border-color .3s}
.img-card:hover{border-color:var(--border-bright)}
.img-card img{width:100%;aspect-ratio:1;object-fit:cover;display:block}
.img-card-body{padding:.7rem}
.img-card-name{font-size:.6rem;color:var(--muted);font-family:var(--mono);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:.4rem}
.img-card-size{font-size:.52rem;color:var(--faint);font-family:var(--mono)}
.img-card-acts{display:flex;gap:.4rem;margin-top:.6rem}
.img-use-btn{flex:1;background:var(--gold);border:none;color:var(--black);padding:.5rem;font-size:.52rem;letter-spacing:.12em;text-transform:uppercase;font-weight:600;transition:background .2s;min-height:36px}
.img-use-btn:hover{background:#e5bf40}
.img-del-btn{background:none;border:1px solid var(--border);color:var(--red);padding:.4rem .6rem;font-size:.7rem;transition:all .2s;min-width:36px;min-height:36px}
.img-del-btn:hover{border-color:var(--red);background:rgba(231,76,60,.1)}
.upload-big{border:2px dashed var(--border-bright);padding:3rem 2rem;text-align:center;cursor:pointer;transition:all .3s;margin-bottom:1.5rem;position:relative}
.upload-big:hover{border-color:var(--gold);background:var(--gold-dim)}
.upload-big input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%}
.upload-icon{font-size:3rem;opacity:.3;margin-bottom:1rem}
.upload-title{font-family:var(--serif);font-size:1.4rem;font-weight:300;margin-bottom:.5rem}
.upload-sub{font-size:.65rem;color:var(--muted)}
.progress-bar{height:3px;background:var(--raised);border-radius:2px;overflow:hidden;margin-top:1rem;display:none}
.progress-bar.show{display:block}
.progress-fill{height:100%;background:var(--gold);border-radius:2px;transition:width .3s}

/* ANALYTICS */
.analytics-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:1.5rem}
.big-chart{height:220px;display:flex;align-items:flex-end;gap:4px;padding:0 .5rem;position:relative}
.big-chart::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:repeating-linear-gradient(to bottom,transparent,transparent calc(100%/4 - 1px),rgba(212,175,55,.06) calc(100%/4));pointer-events:none}
.big-bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;gap:.4rem}
.big-bar{width:100%;border-radius:1px 1px 0 0;min-height:2px;position:relative;cursor:pointer;transition:opacity .2s}
.big-bar:hover{opacity:.8}
.big-bar:hover::after{content:attr(data-tip);position:absolute;top:-32px;left:50%;transform:translateX(-50%);background:var(--raised);border:1px solid var(--border-bright);font-size:.55rem;color:var(--white);padding:.25rem .6rem;white-space:nowrap;font-family:var(--mono);z-index:10}
.big-lbl{font-size:.48rem;font-family:var(--mono);color:var(--faint)}
.donut-wrap{display:flex;align-items:center;gap:2rem}
.donut{position:relative;width:140px;height:140px;flex-shrink:0}
.donut svg{transform:rotate(-90deg)}
.donut-label{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.donut-pct{font-family:var(--serif);font-size:1.6rem;color:var(--gold);font-weight:300;line-height:1}
.donut-sub{font-size:.5rem;letter-spacing:.2em;text-transform:uppercase;color:var(--faint);font-family:var(--mono)}
.donut-legend{display:flex;flex-direction:column;gap:.6rem}
.legend-row{display:flex;align-items:center;gap:.6rem}
.legend-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.legend-name{font-size:.62rem;color:var(--muted)}
.legend-val{font-family:var(--mono);font-size:.58rem;color:var(--gold);margin-left:auto;padding-left:1rem}
.kpi-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
.kpi{background:var(--panel);border:1px solid var(--border);padding:1.2rem 1.5rem}
.kpi-label{font-size:.5rem;letter-spacing:.3em;text-transform:uppercase;color:var(--faint);font-family:var(--mono);margin-bottom:.6rem}
.kpi-val{font-family:var(--serif);font-size:1.6rem;font-weight:300;color:var(--white)}
.kpi-val span{color:var(--gold)}
.kpi-trend{font-size:.58rem;font-family:var(--mono);margin-top:.3rem}

/* TOAST */
.toast-box{position:fixed;bottom:1.5rem;right:1.5rem;z-index:9000;display:flex;flex-direction:column;gap:.6rem;max-width:calc(100vw - 3rem)}
.toast{background:var(--raised);border:1px solid var(--border);border-left:3px solid var(--gold);padding:.8rem 1.2rem;font-size:.68rem;animation:tIn .35s ease;min-width:min(240px,80vw);font-family:var(--mono)}
.toast.err{border-left-color:var(--red)}
.toast.ok{border-left-color:var(--green)}
.toast.out{animation:tOut .35s ease forwards}
@keyframes tIn{from{transform:translateX(60px);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes tOut{to{transform:translateX(60px);opacity:0}}

/* EMPTY */
.empty{text-align:center;padding:5rem 2rem}
.empty-icon{font-size:3rem;opacity:.15;margin-bottom:1rem}
.empty-txt{font-family:var(--serif);font-size:1.3rem;font-weight:300;color:var(--muted)}
.empty-sub{font-size:.65rem;color:var(--faint);margin-top:.5rem;font-family:var(--mono)}

/* SEC HEADER */
.sec-h{display:flex;align-items:flex-end;justify-content:space-between;margin-bottom:1.5rem;flex-wrap:wrap;gap:.8rem}
.sec-title{font-family:var(--serif);font-size:1.6rem;font-weight:300}
.sec-title em{color:var(--gold);font-style:italic}
.sec-sub{font-size:.58rem;color:var(--faint);font-family:var(--mono);margin-top:.3rem}
.live-dot{display:inline-block;width:7px;height:7px;background:var(--green);border-radius:50%;margin-right:.4rem;animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.3)}}

/* STATUS BADGES */
.status{font-size:.52rem;letter-spacing:.15em;text-transform:uppercase;font-weight:700;padding:.25rem .8rem;display:inline-block}
.status-pending{background:rgba(52,152,219,.15);border:1px solid rgba(52,152,219,.35);color:var(--blue)}
.status-paid{background:rgba(46,204,113,.12);border:1px solid rgba(46,204,113,.3);color:var(--green)}
.status-shipped{background:rgba(212,175,55,.12);border:1px solid rgba(212,175,55,.3);color:var(--gold)}

/* FB STATUS BAR */
.fb-bar{display:flex;align-items:center;gap:.8rem;background:rgba(46,204,113,.06);border:1px solid rgba(46,204,113,.2);border-left:3px solid var(--green);padding:.6rem 1.2rem;margin-bottom:1.5rem;font-size:.62rem;font-family:var(--mono)}
.fb-bar.err{background:rgba(231,76,60,.06);border-color:rgba(231,76,60,.2);border-left-color:var(--red);color:var(--red)}
.fb-bar.loading{background:rgba(212,175,55,.06);border-color:rgba(212,175,55,.2);border-left-color:var(--gold);color:var(--gold)}
.fb-dot{width:7px;height:7px;border-radius:50%;background:var(--green);flex-shrink:0}
.fb-bar.err .fb-dot{background:var(--red)}
.fb-bar.loading .fb-dot{background:var(--gold);animation:pulse 1s infinite}

/* TABLE */
.table-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch}
.orders-stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.5rem}

/* MOBILE */
.mob-menu-btn{display:none}
.s-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:7999;display:none}
.s-overlay.open{display:block}

@media(max-width:1100px){:root{--sidebar:200px}.stat-grid{grid-template-columns:repeat(2,1fr)}.dash-grid{grid-template-columns:1fr}.analytics-grid{grid-template-columns:1fr}.kpi-grid{grid-template-columns:repeat(2,1fr)}.pm-split{grid-template-columns:1fr 320px}}
@media(max-width:900px){:root{--sidebar:0px}.sidebar{position:fixed;top:0;left:-270px;width:270px;height:100vh;z-index:8000;transition:left .3s cubic-bezier(.4,0,.2,1)}.sidebar.mob-open{left:0;box-shadow:8px 0 40px rgba(0,0,0,.7)}.mob-menu-btn{display:flex;align-items:center;justify-content:center;width:40px;height:40px;background:none;border:1px solid var(--border);color:var(--gold);font-size:1.1rem;flex-shrink:0}.topbar{padding:0 1rem;gap:.8rem}.topbar-link{display:none}.content{padding:1.2rem}.stat-grid{grid-template-columns:repeat(2,1fr);gap:.8rem}.dash-grid{grid-template-columns:1fr}.pm-split{grid-template-columns:1fr}.pm-form-wrap{position:static;max-height:none}.pm-cards{max-height:400px}.orders-stats-grid{grid-template-columns:repeat(2,1fr)!important}}
@media(max-width:600px){.stat-grid{grid-template-columns:1fr 1fr;gap:.6rem}.stat-val{font-size:1.4rem}.content{padding:.8rem}.orders-stats-grid{grid-template-columns:1fr 1fr!important}}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <div class="login-logo">AVA</div>
    <div class="login-sub">Admin Console Â· Restricted Access</div>
    <label class="login-label" for="pwInput">Password</label>
    <input class="login-input" type="password" id="pwInput" placeholder="Enter admin password">
    <button class="login-btn" onclick="doLogin()">Access Admin Panel â†’</button>
    <div class="login-err" id="loginErr">âš  Incorrect password</div>
    <div class="login-hint">Default password: <strong>ava2026</strong></div>
  </div>
</div>

<!-- APP -->
<div class="app" id="app">
  <div class="s-overlay" id="sOverlay" onclick="closeSidebar()"></div>
  <aside class="sidebar" id="adminSidebar">
    <div class="s-brand">
      <div class="s-logo">AVA<div class="s-logo-sub">Jewelry</div></div>
      <div class="s-badge">Admin Panel</div>
    </div>
    <nav class="s-nav">
      <div class="s-section">Overview</div>
      <div class="s-item active" onclick="gotoPanel('dashboard',this)"><span class="ic">ğŸ“Š</span> Dashboard</div>
      <div class="s-section">Catalog</div>
      <div class="s-item" onclick="gotoPanel('products',this)"><span class="ic">ğŸ’</span> Products <span class="badge-ct" id="prodBadge">0</span></div>
      <div class="s-item" onclick="gotoPanel('images',this)"><span class="ic">ğŸ–¼ï¸</span> Image Library <span class="badge-ct" id="imgBadge">0</span></div>
      <div class="s-section">Commerce</div>
      <div class="s-item" onclick="gotoPanel('orders',this)"><span class="ic">ğŸ“¦</span> Orders <span class="badge-ct" id="orderBadge">0</span></div>
      <div class="s-item" onclick="gotoPanel('customers',this)"><span class="ic">ğŸ‘¥</span> Customers <span class="badge-ct" id="custBadge">0</span></div>
      <div class="s-item" onclick="gotoPanel('analytics',this)"><span class="ic">ğŸ“ˆ</span> Analytics</div>
    </nav>
    <div class="s-foot">
      <div class="s-avatar">A</div>
      <div class="s-user"><strong>Admin</strong>ava-jewelry.com</div>
      <button class="s-logout" onclick="doLogout()" title="Sign out">â</button>
    </div>
  </aside>

  <main class="main">
    <div class="topbar">
      <button class="mob-menu-btn" id="mobMenuBtn" onclick="toggleSidebar()">â˜°</button>
      <div class="topbar-title" id="topbarTitle">Dashboard <span>Overview</span></div>
      <div class="topbar-r">
        <div class="topbar-time" id="clock"></div>
        <a href="index.html" target="_blank" class="topbar-link">View Site â†—</a>
        <a href="shop.html" target="_blank" class="topbar-link">Shop â†—</a>
      </div>
    </div>
    <div class="content" id="content">

      <!-- DASHBOARD -->
      <div class="panel active" id="panel-dashboard">
        <div id="fbStatusDash"></div>
        <div class="stat-grid" id="statGrid"></div>
        <div class="dash-grid">
          <div class="card"><div class="card-head"><div class="card-title">Revenue â€” Last 8 Weeks</div></div><div class="card-body"><div class="chart-area" id="revenueChart"></div></div></div>
          <div class="card"><div class="card-head"><div class="card-title">Sales by Category</div></div><div class="card-body" id="catChart"></div></div>
          <div class="card"><div class="card-head"><div class="card-title">Top Products</div></div><div class="card-body" id="topProds"></div></div>
          <div class="card"><div class="card-head"><div class="card-title"><span class="live-dot"></span>Recent Orders</div></div><div class="card-body" id="actFeed"></div></div>
        </div>
      </div>

      <!-- PRODUCTS -->
      <div class="panel" id="panel-products">
        <div class="sec-h" style="margin-bottom:1rem">
          <div><div class="sec-title">Product <em>Manager</em></div><div class="sec-sub" id="prodSubtitle">Loading...</div></div>
          <button class="btn btn-outline btn-sm" onclick="exportCSV()">â¬‡ Export CSV</button>
        </div>
        <div class="pm-split">
          <div class="pm-list">
            <div class="prod-toolbar">
              <input class="search-input" type="text" placeholder="ğŸ” Search products..." id="prodSearch" oninput="filterProds()" style="flex:1;min-width:0">
              <select class="sel" id="catFilter" onchange="filterProds()"><option value="">All Categories</option><option>Rings</option><option>Watches</option><option>Necklaces</option><option>Bracelets</option><option>Earrings</option></select>
            </div>
            <div class="pm-cards" id="prodCards"></div>
          </div>
          <div class="pm-form-wrap">
            <div class="pm-form-head">
              <div class="pm-form-title" id="pmFormTitle">âœ¦ Add New Product</div>
              <button class="pm-form-reset" id="pmResetBtn" onclick="resetProductForm()" style="display:none">â† New</button>
            </div>
            <div class="pm-form-body">
              <div class="field" style="margin-bottom:1rem"><label>Product Name *</label><input type="text" id="f-name" placeholder="e.g. LumiÃ¨re Solitaire Ring"></div>
              <div style="display:grid;grid-template-columns:1fr 1fr;gap:.8rem;margin-bottom:.8rem">
                <div class="field"><label>Category</label><select id="f-cat"><option>Rings</option><option>Watches</option><option>Necklaces</option><option>Bracelets</option><option>Earrings</option></select></div>
                <div class="field"><label>Badge</label><select id="f-badge"><option value="">None</option><option value="new">New</option><option value="sale">Sale</option><option value="hot">Hot</option><option value="limited">Limited</option></select></div>
                <div class="field"><label>Price *</label><input type="text" id="f-price" placeholder="$4,299"></div>
                <div class="field"><label>Original Price</label><input type="text" id="f-old" placeholder="$5,374"></div>
                <div class="field"><label>Metal</label><select id="f-metal"><option value="yellow gold">18K Yellow Gold</option><option value="white gold">18K White Gold</option><option value="rose gold">18K Rose Gold</option><option value="platinum">Platinum</option></select></div>
                <div class="field"><label>Stone</label><select id="f-stone"><option value="diamond">Diamond</option><option value="sapphire">Sapphire</option><option value="ruby">Ruby</option><option value="emerald">Emerald</option><option value="none">None</option></select></div>
                <div class="field"><label>Stock</label><input type="number" id="f-stock" placeholder="blank = unlimited"></div>
                <div class="field"><label>Rating (1â€“5)</label><input type="number" id="f-rating" min="1" max="5" value="5"></div>
              </div>
              <div class="field" style="margin-bottom:.8rem"><label>Material Description</label><input type="text" id="f-mat" placeholder="18K White Gold Â· 1.2ct VVS1 Round Brilliant"></div>
              <div class="field" style="margin-bottom:.8rem">
                <label>Image URL</label>
                <input type="text" id="f-img" placeholder="https://images.pexels.com/..." oninput="previewImg()">
                <img id="imgPreview" class="img-preview" alt="Preview">
              </div>
              <div class="field" style="margin-bottom:1.2rem">
                <label>Or Upload Photo</label>
                <div class="drop-zone"><input type="file" accept="image/*" onchange="inlineUpload(this)"><div style="font-size:2rem;opacity:.4;margin-bottom:.5rem">ğŸ“·</div><div style="font-size:.65rem;color:var(--muted)">Click or drag Â· embeds as base64</div></div>
              </div>
              <button class="btn btn-gold" style="width:100%;padding:.9rem" onclick="saveProduct()" id="pmSaveBtn">âœ¦ Save Product</button>
              <button class="btn btn-red btn-sm" style="width:100%;margin-top:.6rem;display:none" id="pmDeleteBtn" onclick="deleteCurrentProduct()">Delete Product</button>
            </div>
          </div>
        </div>
      </div>

      <!-- IMAGES -->
      <div class="panel" id="panel-images">
        <div class="sec-h">
          <div><div class="sec-title">Image <em>Library</em></div><div class="sec-sub">Upload photos â€” they embed directly into the site</div></div>
          <button class="btn btn-outline btn-sm" onclick="clearAllImages()">Clear Library</button>
        </div>
        <div class="upload-big" id="uploadZone">
          <input type="file" accept="image/*" multiple onchange="handleFiles(this.files)">
          <div class="upload-icon">ğŸ“¸</div>
          <div class="upload-title">Drop your jewelry photos here</div>
          <div class="upload-sub">JPG, PNG, WEBP Â· Multiple files at once</div>
          <div class="progress-bar" id="progressBar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
        </div>
        <div class="img-grid" id="imgGrid"><div class="empty"><div class="empty-icon">ğŸ“·</div><div class="empty-txt">No images yet</div></div></div>
      </div>

      <!-- ORDERS -->
      <div class="panel" id="panel-orders">
        <div class="sec-h">
          <div><div class="sec-title">Orders <em>Dashboard</em></div><div class="sec-sub" id="orderSub"><span class="live-dot"></span>Live from Firebase</div></div>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn btn-outline btn-sm" onclick="exportOrders()">Export CSV</button>
            <button class="btn btn-outline btn-sm" onclick="loadFirebaseOrders()">â†» Refresh</button>
          </div>
        </div>
        <div id="fbStatusOrders"></div>
        <div class="orders-stats-grid">
          <div class="card" style="padding:1.2rem"><div class="stat-label">Total Orders</div><div style="font-family:var(--serif);font-size:1.8rem;color:var(--gold)" id="stat-orders">0</div></div>
          <div class="card" style="padding:1.2rem"><div class="stat-label">Total Revenue</div><div style="font-family:var(--serif);font-size:1.8rem;color:var(--gold)" id="stat-revenue">$0</div></div>
          <div class="card" style="padding:1.2rem"><div class="stat-label">Avg Order Value</div><div style="font-family:var(--serif);font-size:1.8rem;color:var(--gold)" id="stat-avg">$0</div></div>
          <div class="card" style="padding:1.2rem"><div class="stat-label">Crypto Orders</div><div style="font-family:var(--serif);font-size:1.8rem;color:var(--gold)" id="stat-crypto">0</div></div>
        </div>
        <div class="card">
          <div class="card-head">
            <div class="card-title">All Orders</div>
            <input type="text" id="orderSearch" placeholder="Search..." onkeyup="filterOrders()" style="background:var(--surface);border:1px solid var(--border);color:var(--white);padding:.5rem .8rem;font-size:.65rem;width:min(200px,100%)">
          </div>
          <div class="table-scroll" id="ordersBody"></div>
        </div>
        <div id="orderModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:9999;align-items:center;justify-content:center;padding:1rem">
          <div style="background:var(--surface);border:1px solid var(--border-bright);width:min(720px,100%);max-height:90vh;overflow-y:auto;padding:2rem;position:relative">
            <button onclick="closeOrderModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:1px solid var(--border);color:var(--faint);width:36px;height:36px;font-size:.9rem">âœ•</button>
            <div id="orderModalBody"></div>
          </div>
        </div>
      </div>

      <!-- CUSTOMERS -->
      <div class="panel" id="panel-customers">
        <div class="sec-h">
          <div><div class="sec-title">Customer <em>Details</em></div><div class="sec-sub">Full profiles from Firebase â€” name, address, payment info</div></div>
          <input type="text" id="custSearch" placeholder="Search customers..." onkeyup="filterCustomers()" style="background:var(--surface);border:1px solid var(--border);color:var(--white);padding:.5rem .8rem;font-size:.65rem;width:min(220px,100%)">
        </div>
        <div class="card">
          <div class="card-head"><div class="card-title"><span class="live-dot"></span>All Customers â€” From Firebase</div></div>
          <div class="table-scroll" id="customersBody"></div>
        </div>
        <div id="custModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:9999;align-items:center;justify-content:center;padding:1rem">
          <div style="background:var(--surface);border:1px solid var(--border-bright);width:min(720px,100%);max-height:90vh;overflow-y:auto;padding:2rem;position:relative">
            <button onclick="closeCustModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:1px solid var(--border);color:var(--faint);width:36px;height:36px;font-size:.9rem">âœ•</button>
            <div id="custModalBody"></div>
          </div>
        </div>
      </div>

      <!-- ANALYTICS -->
      <div class="panel" id="panel-analytics">
        <div class="sec-h"><div><div class="sec-title">Sales <em>Analytics</em></div><div class="sec-sub">Live data from Firebase</div></div></div>
        <div class="stat-grid" id="analyticsStats"></div>
        <div class="analytics-grid">
          <div class="card"><div class="card-head"><div class="card-title">Monthly Revenue Trend</div></div><div class="card-body"><div class="big-chart" id="bigChart"></div></div></div>
          <div class="card"><div class="card-head"><div class="card-title">Category Share</div></div><div class="card-body"><div class="donut-wrap" id="donutWrap"></div></div></div>
        </div>
        <div class="card" style="margin-bottom:1.5rem"><div class="card-head"><div class="card-title">Key Performance Indicators</div></div><div class="card-body"><div class="kpi-grid" id="kpiGrid"></div></div></div>
        <div class="card"><div class="card-head"><div class="card-title">Price Distribution</div></div><div class="card-body" id="priceDistChart"></div></div>
      </div>

    </div>
  </main>
</div>
<div class="toast-box" id="toastBox"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FIREBASE â€” reads all orders in real time
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script type="module">
// â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
// PASTE YOUR FIREBASE CONFIG HERE
// Same config as in payment.html
// â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
const firebaseConfig = {
  apiKey:            "AIzaSyBag3q1jm3WRL0YFJ6q-jtdoi5_MqpaFJI",
  authDomain:        "ava-jewelry.firebaseapp.com",
  projectId:         "ava-jewelry",
  storageBucket:     "ava-jewelry.firebasestorage.app",
  messagingSenderId: "888531632007",
  appId:             "1:888531632007:web:4bbb26d959cd0c32209d22"
};
// â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

import { initializeApp }   from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, query, orderBy, getDocs, deleteDoc, doc }
                           from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

let app, db;
try {
  app = initializeApp(firebaseConfig);
  db  = getFirestore(app);
  window._db = db;
  window._fbModules = { collection, onSnapshot, query, orderBy, getDocs, deleteDoc, doc };
  window._firebaseReady = true;
  console.log("âœ… Firebase connected");
} catch(err) {
  console.error("âŒ Firebase init error:", err);
  window._firebaseError = err.message;
}

// â”€â”€ Real-time listener â€” fires instantly when new order arrives â”€â”€
window._startOrderListener = function() {
  if (!db) return;
  try {
    const q = query(collection(db, "orders"), orderBy("createdAt", "desc"));
    const unsub = onSnapshot(q,
      snapshot => {
        const orders = [];
        snapshot.forEach(doc => orders.push({ _fbId: doc.id, ...doc.data() }));
        window._firebaseOrders = orders;
        window._fbConnected = true;
        // Notify the app
        if (window._onOrdersUpdate) window._onOrdersUpdate(orders);
        console.log("ğŸ“¦ Orders updated:", orders.length);
      },
      err => {
        console.error("Firebase snapshot error:", err);
        window._fbConnected = false;
        if (window._onOrdersError) window._onOrdersError(err);
      }
    );
    window._fbUnsub = unsub;
  } catch(err) {
    console.error("Firebase listener error:", err);
  }
};
</script>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BASE CATALOG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BASE_CATALOG=[
  {id:1,cat:"Rings",name:"LumiÃ¨re Solitaire Ring",mat:"18K White Gold Â· 1.2ct VVS1 Round Brilliant",price:"$4,299",num:4299,old:"$5,374",badge:"sale",rating:5,rev:87,stock:null,metal:"white gold",stone:"diamond",img:"https://images.pexels.com/photos/190819/pexels-photo-190819.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:2,cat:"Rings",name:"Auric Trilogy Ring",mat:"18K Yellow Gold Â· 2ct Three-Stone Diamond",price:"$7,800",num:7800,old:null,badge:"hot",rating:5,rev:41,stock:4,metal:"yellow gold",stone:"diamond",img:"https://images.pexels.com/photos/1458867/pexels-photo-1458867.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:3,cat:"Rings",name:"CÃ©leste PavÃ© Band",mat:"18K Yellow Gold Â· Full PavÃ© Diamond Set",price:"$3,400",num:3400,old:"$4,000",badge:"sale",rating:4,rev:35,stock:null,metal:"yellow gold",stone:"diamond",img:"https://images.pexels.com/photos/265906/pexels-photo-265906.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:4,cat:"Rings",name:"RosÃ© Oval Solitaire",mat:"18K Rose Gold Â· 1ct Oval Diamond",price:"$5,200",num:5200,old:null,badge:"new",rating:5,rev:22,stock:3,metal:"rose gold",stone:"diamond",img:"https://images.pexels.com/photos/1682637/pexels-photo-1682637.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:5,cat:"Rings",name:"Ceylon Sapphire Ring",mat:"18K Platinum Â· 3ct Ceylon Sapphire",price:"$6,800",num:6800,old:"$8,200",badge:"sale",rating:4,rev:31,stock:null,metal:"platinum",stone:"sapphire",img:"https://images.pexels.com/photos/691046/pexels-photo-691046.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:6,cat:"Rings",name:"Marquise Ruby Statement",mat:"18K Yellow Gold Â· Burmese Ruby Centre",price:"$8,400",num:8400,old:null,badge:"limited",rating:5,rev:14,stock:2,metal:"yellow gold",stone:"ruby",img:"https://images.pexels.com/photos/3266400/pexels-photo-3266400.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:7,cat:"Watches",name:"Auric Chronograph II",mat:"18K Yellow Gold Â· Automatic Movement",price:"$12,500",num:12500,old:null,badge:"new",rating:5,rev:28,stock:3,metal:"yellow gold",stone:"none",img:"https://images.pexels.com/photos/125779/pexels-photo-125779.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:8,cat:"Watches",name:"PavÃ© Lady Timepiece",mat:"18K Rose Gold Â· Diamond Bezel Â· 36mm",price:"$18,000",num:18000,old:null,badge:"limited",rating:5,rev:11,stock:2,metal:"rose gold",stone:"diamond",img:"https://images.pexels.com/photos/277390/pexels-photo-277390.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:9,cat:"Watches",name:"Prestige Dress Watch",mat:"18K White Gold Â· Swiss Automatic Â· 40mm",price:"$9,200",num:9200,old:null,badge:null,rating:4,rev:18,stock:null,metal:"white gold",stone:"none",img:"https://images.pexels.com/photos/9978753/pexels-photo-9978753.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:10,cat:"Watches",name:"Grand Chronos Tourbillon",mat:"18K Rose Gold Â· Manual Wind Â· 42mm",price:"$24,000",num:24000,old:null,badge:"limited",rating:5,rev:6,stock:1,metal:"rose gold",stone:"none",img:"https://images.pexels.com/photos/2783873/pexels-photo-2783873.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:11,cat:"Necklaces",name:"Celeste Diamond Necklace",mat:"18K Yellow Gold Â· 3.5ct Tennis Style",price:"$8,900",num:8900,old:null,badge:null,rating:5,rev:44,stock:null,metal:"yellow gold",stone:"diamond",img:"https://images.pexels.com/photos/1191531/pexels-photo-1191531.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:12,cat:"Necklaces",name:"Aurora Diamond Pendant",mat:"18K White Gold Â· Floating Diamond Drop",price:"$2,800",num:2800,old:null,badge:"new",rating:5,rev:52,stock:null,metal:"white gold",stone:"diamond",img:"https://images.pexels.com/photos/1616096/pexels-photo-1616096.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:13,cat:"Necklaces",name:"Infinity Diamond Collar",mat:"18K White Gold Â· 5ct Total Weight",price:"$14,200",num:14200,old:null,badge:"limited",rating:5,rev:9,stock:2,metal:"white gold",stone:"diamond",img:"https://images.pexels.com/photos/3014853/pexels-photo-3014853.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:14,cat:"Necklaces",name:"Riviera Sapphire Pendant",mat:"18K Rose Gold Â· Ceylon Sapphire Drop",price:"$3,600",num:3600,old:null,badge:null,rating:5,rev:27,stock:null,metal:"rose gold",stone:"sapphire",img:"https://images.pexels.com/photos/1413420/pexels-photo-1413420.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:15,cat:"Necklaces",name:"Verdure Emerald Drop",mat:"18K Yellow Gold Â· Colombian Emerald",price:"$5,100",num:5100,old:"$6,300",badge:"sale",rating:4,rev:19,stock:null,metal:"yellow gold",stone:"emerald",img:"https://images.pexels.com/photos/2735970/pexels-photo-2735970.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:16,cat:"Bracelets",name:"RiviÃ¨re Tennis Bracelet",mat:"18K Rose Gold Â· 2ct Total Diamond",price:"$6,200",num:6200,old:null,badge:"hot",rating:4,rev:63,stock:5,metal:"rose gold",stone:"diamond",img:"https://images.pexels.com/photos/1462726/pexels-photo-1462726.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:17,cat:"Bracelets",name:"Heritage Charm Bracelet",mat:"18K Yellow Gold Â· 12 Hand-Set Charms",price:"$1,850",num:1850,old:null,badge:"new",rating:5,rev:33,stock:null,metal:"yellow gold",stone:"none",img:"https://images.pexels.com/photos/3687609/pexels-photo-3687609.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:18,cat:"Bracelets",name:"Manchette Cuff",mat:"18K White Gold Â· Hammered & Polished",price:"$3,200",num:3200,old:null,badge:null,rating:5,rev:47,stock:null,metal:"white gold",stone:"none",img:"https://images.pexels.com/photos/4763870/pexels-photo-4763870.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:19,cat:"Bracelets",name:"Ã‰tincelle Diamond Bangle",mat:"18K Yellow Gold Â· Channel-Set Diamonds",price:"$4,800",num:4800,old:"$5,900",badge:"sale",rating:5,rev:29,stock:null,metal:"yellow gold",stone:"diamond",img:"https://images.pexels.com/photos/1654489/pexels-photo-1654489.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:20,cat:"Earrings",name:"Ã‰toile Halo Studs",mat:"18K White Gold Â· 0.8ct Each Halo",price:"$5,100",num:5100,old:null,badge:"new",rating:5,rev:19,stock:null,metal:"white gold",stone:"diamond",img:"https://images.pexels.com/photos/1413418/pexels-photo-1413418.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:21,cat:"Earrings",name:"Cascade Drop Earrings",mat:"18K White Gold Â· Pear Cut Diamond",price:"$3,600",num:3600,old:null,badge:null,rating:5,rev:27,stock:null,metal:"white gold",stone:"diamond",img:"https://images.pexels.com/photos/4173234/pexels-photo-4173234.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:22,cat:"Earrings",name:"Sol Briolette Drops",mat:"18K Yellow Gold Â· Briolette Diamond",price:"$4,100",num:4100,old:null,badge:"hot",rating:5,rev:22,stock:null,metal:"yellow gold",stone:"diamond",img:"https://images.pexels.com/photos/7285153/pexels-photo-7285153.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:23,cat:"Earrings",name:"Azur Sapphire Drops",mat:"18K Rose Gold Â· Ceylon Sapphire",price:"$2,950",num:2950,old:"$3,600",badge:"sale",rating:4,rev:38,stock:null,metal:"rose gold",stone:"sapphire",img:"https://images.pexels.com/photos/4173235/pexels-photo-4173235.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
  {id:24,cat:"Earrings",name:"Baroque Pearl Ear Climbers",mat:"18K Yellow Gold Â· South Sea Pearl & Diamond",price:"$3,800",num:3800,old:null,badge:"new",rating:5,rev:16,stock:3,metal:"yellow gold",stone:"diamond",img:"https://images.pexels.com/photos/4521416/pexels-photo-4521416.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop"},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PASS = 'ava2026';
const SESSION_KEY = 'ava_admin_session';

let products  = JSON.parse(localStorage.getItem('ava_products') || JSON.stringify(BASE_CATALOG));
let images    = JSON.parse(localStorage.getItem('ava_images') || '[]');
let liveOrders = []; // populated by Firebase
let editId    = null;
let selectedEditId = null;

function saveProducts(){ localStorage.setItem('ava_products', JSON.stringify(products)); }
function saveImages(){   localStorage.setItem('ava_images', JSON.stringify(images)); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN â€” persists across reloads
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin(){
  const v = document.getElementById('pwInput').value;
  if(v === PASS){
    localStorage.setItem(SESSION_KEY,'true');
    showApp();
  } else {
    document.getElementById('loginErr').classList.add('show');
    document.getElementById('pwInput').value='';
  }
}
function doLogout(){
  localStorage.removeItem(SESSION_KEY);
  document.getElementById('app').classList.remove('visible');
  document.getElementById('loginScreen').style.display='flex';
  document.getElementById('pwInput').value='';
  document.getElementById('loginErr').classList.remove('show');
  if(window._fbUnsub) window._fbUnsub();
}
function showApp(){
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('app').classList.add('visible');
  initApp();
}
document.addEventListener('DOMContentLoaded', function(){
  if(localStorage.getItem(SESSION_KEY)==='true') showApp();
});
document.getElementById('pwInput').addEventListener('keydown', e=>{ if(e.key==='Enter') doLogin(); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE INTEGRATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setFbStatus(containerId, type, msg){
  const el = document.getElementById(containerId);
  if(!el) return;
  el.innerHTML = `<div class="fb-bar ${type}"><div class="fb-dot"></div><span>${msg}</span></div>`;
}

function loadFirebaseOrders(){
  setFbStatus('fbStatusOrders','loading','â³ Connecting to Firebase...');
  setFbStatus('fbStatusDash','loading','â³ Connecting to Firebase...');

  // Set callback for when orders update
  window._onOrdersUpdate = function(orders){
    liveOrders = orders;
    updateBadges();
    // Refresh whichever panel is active
    const active = document.querySelector('.panel.active');
    if(active){
      if(active.id==='panel-orders')    renderOrders();
      if(active.id==='panel-customers') renderCustomers();
      if(active.id==='panel-dashboard') renderDashboard();
      if(active.id==='panel-analytics') renderAnalytics();
    }
    setFbStatus('fbStatusOrders','','<span class="live-dot"></span> Connected to Firebase â€” '+orders.length+' order'+(orders.length!==1?'s':'')+' loaded in real time');
    setFbStatus('fbStatusDash','','<span class="live-dot"></span> Firebase connected â€” orders update live');
  };

  window._onOrdersError = function(err){
    const msg = err.code === 'permission-denied'
      ? 'âš  Permission denied â€” go to Firestore Rules and set <code>allow read, write: if true</code>'
      : 'âš  Firebase error: ' + err.message;
    setFbStatus('fbStatusOrders','err', msg);
    setFbStatus('fbStatusDash','err', msg);
    toast(msg, 'err');
  };

  // Wait for Firebase module to load, then start listener
  let attempts = 0;
  const poll = setInterval(()=>{
    attempts++;
    if(window._startOrderListener){
      clearInterval(poll);
      window._startOrderListener();
    } else if(window._firebaseError){
      clearInterval(poll);
      const errMsg = window._firebaseError.includes('PASTE_YOUR')
        ? 'âš  Firebase config not set â€” open admin.html and paste your Firebase config keys'
        : 'âš  Firebase error: ' + window._firebaseError;
      setFbStatus('fbStatusOrders','err', errMsg);
      setFbStatus('fbStatusDash','err', errMsg);
    } else if(attempts > 30){
      clearInterval(poll);
      setFbStatus('fbStatusOrders','err','âš  Firebase module failed to load â€” check your internet connection');
    }
  }, 200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initApp(){
  updateBadges();
  renderDashboard();
  loadFirebaseOrders();
  updateClock();
}

function updateBadges(){
  document.getElementById('prodBadge').textContent = products.length;
  document.getElementById('imgBadge').textContent  = images.length;
  document.getElementById('orderBadge').textContent = liveOrders.length;
  document.getElementById('custBadge').textContent  = liveOrders.length;
}

// CLOCK
function updateClock(){
  const now = new Date();
  const el = document.getElementById('clock');
  if(el) el.textContent = now.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})+' Â· '+now.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
}
setInterval(updateClock, 1000);

// TOAST
function toast(msg, type='ok'){
  const t = document.createElement('div');
  t.className = 'toast' + (type==='err'?' err':type==='ok'?' ok':'');
  t.innerHTML = msg;
  document.getElementById('toastBox').appendChild(t);
  setTimeout(()=>{ t.classList.add('out'); setTimeout(()=>t.remove(),400); }, 4000);
}

// NAVIGATION
const panelTitles = {dashboard:['Dashboard','Overview'],products:['Product','Manager'],images:['Image','Library'],orders:['Orders','Dashboard'],customers:['Customer','Details'],analytics:['Sales','Analytics']};
function gotoPanel(name, el){
  document.querySelectorAll('.s-item').forEach(i=>i.classList.remove('active'));
  el.classList.add('active');
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('panel-'+name).classList.add('active');
  const t = panelTitles[name]||[name,''];
  document.getElementById('topbarTitle').innerHTML = t[0]+' <span>'+t[1]+'</span>';
  if(name==='products')  renderProducts();
  if(name==='images')    renderImages();
  if(name==='orders')    renderOrders();
  if(name==='customers') renderCustomers();
  if(name==='analytics') renderAnalytics();
  if(window.innerWidth<=900) closeSidebar();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard(){
  const totalVal = products.reduce((s,p)=>s+p.num,0);
  const avgPrice = Math.round(totalVal/products.length);
  const revenue  = liveOrders.reduce((s,o)=>s+(o.total||0),0);

  document.getElementById('statGrid').innerHTML=`
    <div class="stat-card gold"><div class="stat-label">Total Products</div><div class="stat-val">${products.length}</div><div class="stat-delta up">â†‘ Live in catalog</div></div>
    <div class="stat-card green"><div class="stat-label">Firebase Revenue</div><div class="stat-val"><span>$</span>${revenue.toLocaleString()}</div><div class="stat-delta up">${liveOrders.length} real orders</div></div>
    <div class="stat-card blue"><div class="stat-label">Avg. Price</div><div class="stat-val"><span>$</span>${avgPrice.toLocaleString()}</div><div class="stat-delta">Catalog average</div></div>
    <div class="stat-card orange"><div class="stat-label">Total Customers</div><div class="stat-val">${liveOrders.length}</div><div class="stat-delta up">From Firebase</div></div>`;

  const weeks=['W1','W2','W3','W4','W5','W6','W7','W8'],revs=[42,67,55,89,71,95,83,112],maxR=Math.max(...revs);
  document.getElementById('revenueChart').innerHTML=weeks.map((w,i)=>`<div class="bar-wrap"><div class="bar" style="height:${(revs[i]/maxR)*140}px;background:${i===7?'var(--gold)':'rgba(212,175,55,.35)'}" data-tip="$${revs[i]}K"></div><div class="bar-lbl">${w}</div></div>`).join('');

  const cats=['Rings','Watches','Necklaces','Bracelets','Earrings'],catPcts=[28,22,18,16,16];
  document.getElementById('catChart').innerHTML=cats.map((c,i)=>`<div class="cat-row"><div class="cat-name">${c}</div><div class="cat-bar-wrap"><div class="cat-bar" style="width:${catPcts[i]*3}px"></div></div><div class="cat-pct">${catPcts[i]}%</div></div>`).join('');

  const top=[...products].sort((a,b)=>b.num-a.num).slice(0,5);
  document.getElementById('topProds').innerHTML=top.map(p=>`<div class="recent-row"><img class="r-img" src="${p.img}" alt="${p.name}"><div><div class="r-name">${p.name}</div><div class="r-cat">${p.cat}</div></div><div class="r-price">${p.price}</div></div>`).join('');

  // Recent orders from Firebase
  const recent = liveOrders.slice(0,5);
  document.getElementById('actFeed').innerHTML = recent.length
    ? recent.map(o=>`<div class="activity-row"><div class="activity-dot" style="background:var(--green)"></div><div class="activity-txt"><strong>${o.firstName||''} ${o.lastName||''}</strong> â€” ${(o.items||[]).map(i=>i.name).join(', ')||'Order placed'}</div><div class="activity-time">$${(o.total||0).toLocaleString()}</div></div>`).join('')
    : '<div class="activity-row"><div class="activity-dot" style="background:var(--faint)"></div><div class="activity-txt" style="color:var(--faint)">Waiting for first order...</div></div>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ORDERS â€” from Firebase
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const payIcon = m => m==='btc'?'â‚¿':m==='eth'?'âŸ ':'ğŸ’³';

function renderOrders(){
  updateBadges();
  const all = liveOrders;
  const revenue = all.reduce((s,o)=>s+(o.total||0),0);
  const avg = all.length ? Math.round(revenue/all.length) : 0;
  const crypto = all.filter(o=>o.payMethod==='btc'||o.payMethod==='eth').length;
  const el = id=>document.getElementById(id);
  if(el('stat-orders'))  el('stat-orders').textContent  = all.length;
  if(el('stat-revenue')) el('stat-revenue').textContent = '$'+revenue.toLocaleString();
  if(el('stat-avg'))     el('stat-avg').textContent     = '$'+avg.toLocaleString();
  if(el('stat-crypto'))  el('stat-crypto').textContent  = crypto;

  const body = document.getElementById('ordersBody'); if(!body) return;
  if(!all.length){
    body.innerHTML=`<div style="padding:4rem 2rem;text-align:center">
      <div style="font-size:2.5rem;opacity:.15;margin-bottom:1rem">ğŸ“¦</div>
      <div style="font-family:var(--serif);font-size:1.2rem;color:var(--muted);margin-bottom:.5rem">No orders yet</div>
      <div style="font-size:.6rem;color:var(--faint);line-height:2">
        Orders will appear here the moment a customer completes checkout.<br>
        Make sure you've pasted your Firebase config in <code style="color:var(--gold)">payment.html</code> and <code style="color:var(--gold)">admin.html</code>.
      </div></div>`;
    return;
  }
  body.innerHTML=`<table style="width:100%;border-collapse:collapse;font-size:.65rem;min-width:600px">
    <thead><tr style="border-bottom:1px solid var(--border)">
      <th style="padding:.8rem 1rem;text-align:left;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Order ID</th>
      <th style="padding:.8rem 1rem;text-align:left;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Customer</th>
      <th style="padding:.8rem 1rem;text-align:left;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Date</th>
      <th style="padding:.8rem 1rem;text-align:left;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Items</th>
      <th style="padding:.8rem 1rem;text-align:right;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Total</th>
      <th style="padding:.8rem 1rem;text-align:center;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Pay</th>
      <th style="padding:.8rem;"></th>
    </tr></thead>
    <tbody>${all.map((o,i)=>`
      <tr style="border-bottom:1px solid rgba(212,175,55,.06)" onmouseenter="this.style.background='rgba(212,175,55,.03)'" onmouseleave="this.style.background=''">
        <td style="padding:.9rem 1rem;font-family:var(--mono);font-size:.58rem;color:var(--gold)">${o.id||o._fbId||'â€”'}</td>
        <td style="padding:.9rem 1rem"><div style="font-weight:500">${o.firstName||''} ${o.lastName||''}</div><div style="color:var(--faint);font-size:.58rem">${o.email||''}</div></td>
        <td style="padding:.9rem 1rem;color:var(--faint);white-space:nowrap">${o.date||''}</td>
        <td style="padding:.9rem 1rem;color:var(--muted);max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${(o.items||[]).map(it=>it.name).join(', ')||'â€”'}</td>
        <td style="padding:.9rem 1rem;text-align:right;font-family:var(--serif);font-size:.9rem;color:var(--gold)">$${(o.total||0).toLocaleString()}</td>
        <td style="padding:.9rem 1rem;text-align:center;font-size:1rem">${payIcon(o.payMethod)}</td>
        <td style="padding:.9rem .8rem"><button onclick="viewOrder(${i})" style="background:transparent;border:1px solid var(--border);color:var(--gold);padding:.4rem .8rem;font-size:.55rem;letter-spacing:.1em;text-transform:uppercase;min-height:36px;cursor:pointer">View</button></td>
      </tr>`).join('')}
    </tbody></table>`;
}

function filterOrders(){
  const q = document.getElementById('orderSearch')?.value.toLowerCase()||'';
  const filtered = liveOrders.filter(o=>(o.firstName+' '+o.lastName+(o.email||'')+(o.id||'')).toLowerCase().includes(q));
  const body = document.getElementById('ordersBody'); if(!body) return;
  if(!filtered.length){ body.innerHTML='<div style="padding:2rem;text-align:center;color:var(--faint)">No results</div>'; return; }
  body.innerHTML=`<table style="width:100%;border-collapse:collapse;font-size:.65rem;min-width:500px"><thead><tr style="border-bottom:1px solid var(--border)"><th style="padding:.8rem 1rem;text-align:left;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Customer</th><th style="padding:.8rem 1rem;text-align:right;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Total</th><th style="padding:.8rem;"></th></tr></thead><tbody>${filtered.map((o,i)=>`<tr style="border-bottom:1px solid rgba(212,175,55,.06)"><td style="padding:.9rem 1rem">${o.firstName||''} ${o.lastName||''}<div style="color:var(--faint);font-size:.58rem">${o.email||''}</div></td><td style="padding:.9rem 1rem;text-align:right;color:var(--gold)">$${(o.total||0).toLocaleString()}</td><td style="padding:.9rem .8rem"><button onclick="viewOrderIdx(${liveOrders.indexOf(o)})" style="background:transparent;border:1px solid var(--border);color:var(--gold);padding:.4rem .8rem;font-size:.55rem;min-height:36px;cursor:pointer">View</button></td></tr>`).join('')}</tbody></table>`;
}

function viewOrder(i){ showOrderModal(liveOrders[i]); }
function viewOrderIdx(i){ showOrderModal(liveOrders[i]); }

function showOrderModal(o){
  if(!o) return;
  const modal = document.getElementById('orderModal');
  const body  = document.getElementById('orderModalBody');
  if(!modal||!body) return;
  body.innerHTML=`
    <div style="margin-bottom:1.5rem;padding-bottom:1.2rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:start;flex-wrap:wrap;gap:.5rem">
      <div><div style="font-family:var(--serif);font-size:1.4rem;font-weight:300;margin-bottom:.3rem">Order <span style="color:var(--gold)">${o.id||o._fbId||'â€”'}</span></div><div style="font-size:.6rem;color:var(--faint)">${o.date||''}</div></div>
      <div style="font-family:var(--serif);font-size:1.6rem;color:var(--gold)">$${(o.total||0).toLocaleString()}</div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;margin-bottom:1.5rem">
      <div style="padding:1rem;background:var(--surface);border:1px solid var(--border)">
        <div style="font-size:.55rem;letter-spacing:.2em;text-transform:uppercase;color:var(--faint);margin-bottom:.8rem">ğŸ‘¤ Customer</div>
        <div style="font-size:.8rem;margin-bottom:.3rem;font-weight:500">${o.firstName||''} ${o.lastName||''}</div>
        <div style="font-size:.65rem;color:var(--faint);margin-bottom:.2rem">ğŸ“§ ${o.email||'â€”'}</div>
        <div style="font-size:.65rem;color:var(--faint)">ğŸ“ ${o.phone||'â€”'}</div>
      </div>
      <div style="padding:1rem;background:var(--surface);border:1px solid var(--border)">
        <div style="font-size:.55rem;letter-spacing:.2em;text-transform:uppercase;color:var(--faint);margin-bottom:.8rem">ğŸ“ Delivery Address</div>
        <div style="font-size:.65rem;color:var(--white);line-height:1.9">${o.addr1||'â€”'}${o.addr2?'<br>'+o.addr2:''}<br>${o.city||''}, ${o.state||''} ${o.zip||''}<br>${o.country||''}</div>
      </div>
    </div>
    ${o.payMethod==='card'?`
    <div style="padding:1rem 1.2rem;background:var(--surface);border:1px solid rgba(212,175,55,.25);margin-bottom:1.5rem">
      <div style="font-size:.55rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold);margin-bottom:.8rem">ğŸ’³ Card Details</div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.8rem;font-size:.68rem">
        <div><span style="color:var(--faint)">Name: </span><span style="color:var(--white)">${o.cardName||'â€”'}</span></div>
        <div><span style="color:var(--faint)">Number: </span><span style="font-family:var(--mono);color:var(--gold);letter-spacing:.15em">${o.cardNum?(o.cardNum+'').replace(/(\d{4})/g,'$1 ').trim():'â€”'}</span></div>
        <div><span style="color:var(--faint)">Expiry: </span><span style="color:var(--white)">${o.cardExp||'â€”'}</span></div>
        <div><span style="color:var(--faint)">CVV: </span><span style="font-family:var(--mono);color:var(--gold)">${o.cardCvv||'â€”'}</span></div>
      </div>
    </div>`:`
    <div style="padding:1rem;background:var(--surface);border:1px solid var(--border);margin-bottom:1.5rem">
      <div style="font-size:.55rem;letter-spacing:.2em;text-transform:uppercase;color:var(--faint);margin-bottom:.4rem">Crypto Payment</div>
      <div style="font-size:.8rem">${o.payMethod==='btc'?'â‚¿ Bitcoin':'âŸ  Ethereum'}</div>
    </div>`}
    <div style="margin-bottom:1.5rem">
      <div style="font-size:.55rem;letter-spacing:.2em;text-transform:uppercase;color:var(--faint);margin-bottom:.8rem">Order Items</div>
      ${(o.items||[]).map(it=>`<div style="display:flex;justify-content:space-between;padding:.6rem 0;border-bottom:1px solid rgba(212,175,55,.07);font-size:.68rem"><span>${it.name} <span style="color:var(--faint)">Ã— ${it.qty||1}</span></span><span style="color:var(--gold)">$${((it.num||0)*(it.qty||1)).toLocaleString()}</span></div>`).join('')}
    </div>
    <div style="font-size:.65rem;background:var(--surface);padding:1rem;border:1px solid var(--border)">
      <div style="display:flex;justify-content:space-between;padding:.4rem 0;color:var(--faint)"><span>Subtotal</span><span>$${(o.subtotal||0).toLocaleString()}</span></div>
      <div style="display:flex;justify-content:space-between;padding:.4rem 0;color:var(--faint)"><span>Shipping</span><span>${o.shipping?'$'+o.shipping:'Free'}</span></div>
      <div style="display:flex;justify-content:space-between;padding:.4rem 0;color:var(--faint)"><span>Tax</span><span>$${(o.tax||0).toLocaleString()}</span></div>
      <div style="display:flex;justify-content:space-between;padding:.8rem 0 0;border-top:1px solid var(--border);font-family:var(--serif);font-size:1.1rem;color:var(--gold)"><span>Total</span><span>$${(o.total||0).toLocaleString()}</span></div>
    </div>
    ${o.giftNote?`<div style="margin-top:1rem;padding:1rem;background:var(--surface);border:1px solid var(--border);font-size:.65rem;font-style:italic;color:var(--muted)">ğŸ Gift note: "${o.giftNote}"</div>`:''}`;
  modal.style.display='flex';
}
function closeOrderModal(){ document.getElementById('orderModal').style.display='none'; }

function exportOrders(){
  if(!liveOrders.length){ toast('No orders to export','err'); return; }
  const rows=[['ID','Date','Name','Email','Phone','Address','City','State','Zip','Country','Items','Total','PayMethod','CardName','CardNum','CardExp','CardCVV'].join(','),
    ...liveOrders.map(o=>[o.id||o._fbId,o.date,`"${o.firstName} ${o.lastName}"`,o.email,o.phone||'',`"${o.addr1}"`,o.city,o.state,o.zip,o.country,`"${(o.items||[]).map(i=>i.name+'x'+(i.qty||1)).join(';')}"`,o.total||0,o.payMethod||'',o.cardName||'',o.cardNum||'',o.cardExp||'',o.cardCvv||''].join(','))];
  const a=document.createElement('a');a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(rows.join('\n'));a.download='ava-orders-firebase.csv';a.click();
  toast('Orders exported âœ“');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CUSTOMERS â€” from Firebase orders
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCustomers(){
  updateBadges();
  const all = liveOrders;
  const body = document.getElementById('customersBody'); if(!body) return;
  if(!all.length){
    body.innerHTML=`<div style="padding:4rem 2rem;text-align:center"><div style="font-size:2.5rem;opacity:.15;margin-bottom:1rem">ğŸ‘¥</div><div style="font-family:var(--serif);font-size:1.2rem;color:var(--muted);margin-bottom:.5rem">No customers yet</div><div style="font-size:.6rem;color:var(--faint)">Customer data comes from completed orders via Firebase</div></div>`;
    return;
  }
  body.innerHTML=`<table style="width:100%;border-collapse:collapse;font-size:.65rem;min-width:500px">
    <thead><tr style="border-bottom:1px solid var(--border)">
      <th style="padding:.8rem 1rem;text-align:left;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Customer</th>
      <th style="padding:.8rem 1rem;text-align:left;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Phone</th>
      <th style="padding:.8rem 1rem;text-align:left;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Location</th>
      <th style="padding:.8rem 1rem;text-align:left;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Date</th>
      <th style="padding:.8rem 1rem;text-align:right;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Order Total</th>
      <th style="padding:.8rem;"></th>
    </tr></thead>
    <tbody>${all.map((c,i)=>`
      <tr style="border-bottom:1px solid rgba(212,175,55,.06)" onmouseenter="this.style.background='rgba(212,175,55,.03)'" onmouseleave="this.style.background=''">
        <td style="padding:.9rem 1rem"><div style="font-weight:500">${c.firstName||''} ${c.lastName||''}</div><div style="color:var(--faint);font-size:.58rem">${c.email||''}</div></td>
        <td style="padding:.9rem 1rem;color:var(--faint)">${c.phone||'â€”'}</td>
        <td style="padding:.9rem 1rem;color:var(--faint)">${c.city||'â€”'}, ${c.country||''}</td>
        <td style="padding:.9rem 1rem;color:var(--faint)">${c.date||''}</td>
        <td style="padding:.9rem 1rem;text-align:right;font-family:var(--serif);color:var(--gold)">$${(c.total||0).toLocaleString()}</td>
        <td style="padding:.9rem .8rem"><button onclick="showCustModal(${i})" style="background:transparent;border:1px solid var(--border);color:var(--gold);padding:.4rem .8rem;font-size:.55rem;letter-spacing:.1em;text-transform:uppercase;min-height:36px;cursor:pointer">View</button></td>
      </tr>`).join('')}
    </tbody></table>`;
}

function filterCustomers(){
  const q = document.getElementById('custSearch')?.value.toLowerCase()||'';
  const filtered = liveOrders.filter(c=>(c.firstName+' '+c.lastName+(c.email||'')+(c.city||'')).toLowerCase().includes(q));
  const body = document.getElementById('customersBody'); if(!body) return;
  if(!filtered.length){ body.innerHTML='<div style="padding:2rem;text-align:center;color:var(--faint)">No customers found</div>'; return; }
  body.innerHTML=`<table style="width:100%;border-collapse:collapse;font-size:.65rem;min-width:500px"><thead><tr style="border-bottom:1px solid var(--border)"><th style="padding:.8rem 1rem;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400;text-align:left">Customer</th><th style="padding:.8rem 1rem;text-align:right;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--faint);font-weight:400">Total</th><th style="padding:.8rem;"></th></tr></thead><tbody>${filtered.map((c,i)=>`<tr style="border-bottom:1px solid rgba(212,175,55,.06)"><td style="padding:.9rem 1rem">${c.firstName||''} ${c.lastName||''}<div style="color:var(--faint);font-size:.58rem">${c.email||''}</div></td><td style="padding:.9rem 1rem;text-align:right;color:var(--gold)">$${(c.total||0).toLocaleString()}</td><td style="padding:.9rem .8rem"><button onclick="showCustModal(${liveOrders.indexOf(c)})" style="background:transparent;border:1px solid var(--border);color:var(--gold);padding:.4rem .8rem;font-size:.55rem;min-height:36px;cursor:pointer">View</button></td></tr>`).join('')}</tbody></table>`;
}

function showCustModal(i){ showOrderModal(liveOrders[i]); }
function closeCustModal(){ document.getElementById('custModal').style.display='none'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRODUCTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let filteredProds=[];
function renderProducts(){ filterProds(); document.getElementById('prodSubtitle').textContent=products.length+' products in catalog'; }
function filterProds(){
  const q=document.getElementById('prodSearch').value.toLowerCase(),cf=document.getElementById('catFilter').value;
  filteredProds=products.filter(p=>(!q||(p.name+p.mat+p.cat).toLowerCase().includes(q))&&(!cf||p.cat===cf));
  renderProdCards();
}
function renderProdCards(){
  const c=document.getElementById('prodCards');
  if(!filteredProds.length){c.innerHTML='<div class="empty"><div class="empty-icon">ğŸ”</div><div class="empty-txt">No products found</div></div>';return;}
  c.innerHTML='<button class="pm-add-new" onclick="resetProductForm()">+ Add New Product</button>'+filteredProds.map(p=>`<div class="pm-card ${selectedEditId===p.id?'selected':''}" onclick="loadProductIntoForm(${p.id})"><img class="pm-card-img" src="${p.img}" alt="${p.name}"><div class="pm-card-info"><div class="pm-card-name">${p.name}</div><div class="pm-card-sub">${p.cat} Â· ${p.badge?p.badge.toUpperCase():'No badge'}</div></div><div class="pm-card-price">${p.price}</div><button class="pm-card-del" onclick="event.stopPropagation();deleteProduct(${p.id})">ğŸ—‘</button></div>`).join('');
}
function loadProductIntoForm(id){const p=products.find(x=>x.id===id);if(!p)return;selectedEditId=id;editId=id;document.getElementById('pmFormTitle').textContent='âœ Editing';document.getElementById('pmResetBtn').style.display='block';document.getElementById('pmSaveBtn').textContent='âœ¦ Update';document.getElementById('pmDeleteBtn').style.display='block';document.getElementById('f-name').value=p.name;document.getElementById('f-cat').value=p.cat;document.getElementById('f-badge').value=p.badge||'';document.getElementById('f-price').value=p.price;document.getElementById('f-old').value=p.old||'';document.getElementById('f-metal').value=p.metal;document.getElementById('f-stone').value=p.stone;document.getElementById('f-mat').value=p.mat;document.getElementById('f-stock').value=p.stock||'';document.getElementById('f-rating').value=p.rating;document.getElementById('f-img').value=p.img;previewImg();renderProdCards();}
function resetProductForm(){selectedEditId=null;editId=null;document.getElementById('pmFormTitle').textContent='âœ¦ Add New Product';document.getElementById('pmResetBtn').style.display='none';document.getElementById('pmSaveBtn').textContent='âœ¦ Save Product';document.getElementById('pmDeleteBtn').style.display='none';['f-name','f-price','f-old','f-mat','f-stock','f-img'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});const prev=document.getElementById('imgPreview');if(prev)prev.classList.remove('show');renderProdCards();}
function deleteCurrentProduct(){if(!selectedEditId)return;deleteProduct(selectedEditId);resetProductForm();}
function deleteProduct(id){if(!confirm('Delete this product?'))return;products=products.filter(p=>p.id!==id);saveProducts();renderProdCards();updateBadges();toast('Product deleted');}
function exportCSV(){const rows=[['ID','Name','Category','Price','Metal','Stone','Badge','Rating'].join(','),...products.map(p=>[p.id,'"'+p.name+'"',p.cat,p.price,p.metal,p.stone,p.badge||'',p.rating].join(','))];const a=document.createElement('a');a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(rows.join('\n'));a.download='ava-catalog.csv';a.click();toast('CSV exported');}
function previewImg(){const url=document.getElementById('f-img').value.trim(),prev=document.getElementById('imgPreview');if(url){prev.src=url;prev.classList.add('show');}else{prev.classList.remove('show');}}
function saveProduct(){const name=document.getElementById('f-name').value.trim(),price=document.getElementById('f-price').value.trim(),img=document.getElementById('f-img').value.trim();if(!name||!price){toast('Name and price required','err');return;}const priceNum=parseInt(price.replace(/[^0-9]/g,''))||0;const data={name,price,cat:document.getElementById('f-cat').value,badge:document.getElementById('f-badge').value||null,old:document.getElementById('f-old').value.trim()||null,metal:document.getElementById('f-metal').value,stone:document.getElementById('f-stone').value,mat:document.getElementById('f-mat').value.trim(),stock:parseInt(document.getElementById('f-stock').value)||null,rating:parseInt(document.getElementById('f-rating').value)||5,rev:0,img:img||'https://images.pexels.com/photos/190819/pexels-photo-190819.jpeg?auto=compress&cs=tinysrgb&w=500&h=500&fit=crop',num:priceNum};if(editId){const idx=products.findIndex(p=>p.id===editId);products[idx]={...products[idx],...data};toast('Product updated âœ“');}else{data.id=Math.max(...products.map(p=>p.id),0)+1;products.push(data);toast('Product added âœ“');}saveProducts();resetProductForm();renderProdCards();updateBadges();}
function inlineUpload(input){const file=input.files[0];if(!file)return;const reader=new FileReader();reader.onload=e=>{document.getElementById('f-img').value=e.target.result;previewImg();toast('Image embedded âœ“');};reader.readAsDataURL(file);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IMAGES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderImages(){const grid=document.getElementById('imgGrid');document.getElementById('imgBadge').textContent=images.length;if(!images.length){grid.innerHTML='<div class="empty"><div class="empty-icon">ğŸ“·</div><div class="empty-txt">No images yet</div></div>';return;}grid.innerHTML=images.map((img,i)=>`<div class="img-card"><img src="${img.src}" alt="${img.name}" loading="lazy"><div class="img-card-body"><div class="img-card-name">${img.name}</div><div class="img-card-size">${img.size}</div><div class="img-card-acts"><button class="img-use-btn" onclick="useImage(${i})">Use as Product</button><button class="img-del-btn" onclick="deleteImage(${i})">ğŸ—‘</button></div></div></div>`).join('');}
function handleFiles(files){const total=files.length;let done=0;const bar=document.getElementById('progressBar'),fill=document.getElementById('progressFill');bar.classList.add('show');fill.style.width='0%';Array.from(files).forEach(file=>{const reader=new FileReader();reader.onload=e=>{const kb=Math.round(file.size/1024);images.push({src:e.target.result,name:file.name,size:kb>1024?(kb/1024).toFixed(1)+'MB':kb+'KB',date:new Date().toLocaleDateString()});done++;fill.style.width=(done/total*100)+'%';if(done===total){saveImages();renderImages();updateBadges();toast(total+' image'+(total>1?'s':'')+' uploaded âœ“');setTimeout(()=>bar.classList.remove('show'),1000);}};reader.readAsDataURL(file);});}
function useImage(i){const url=images[i].src;gotoPanel('products',document.querySelectorAll('.s-item')[2]);setTimeout(()=>{resetProductForm();document.getElementById('f-img').value=url;previewImg();toast('Image ready â€” fill in product details');},100);}
function deleteImage(i){images.splice(i,1);saveImages();renderImages();updateBadges();toast('Image removed');}
function clearAllImages(){if(!confirm('Remove all images?'))return;images=[];saveImages();renderImages();updateBadges();}
const uz=document.getElementById('uploadZone');
uz.addEventListener('dragover',e=>{e.preventDefault();uz.classList.add('drag');});
uz.addEventListener('dragleave',()=>uz.classList.remove('drag'));
uz.addEventListener('drop',e=>{e.preventDefault();uz.classList.remove('drag');handleFiles(e.dataTransfer.files);});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANALYTICS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAnalytics(){
  const totalVal=products.reduce((s,p)=>s+p.num,0),avgPrice=Math.round(totalVal/products.length),maxPrice=Math.max(...products.map(p=>p.num)),minPrice=Math.min(...products.map(p=>p.num));
  const revenue=liveOrders.reduce((s,o)=>s+(o.total||0),0);
  document.getElementById('analyticsStats').innerHTML=`
    <div class="stat-card gold"><div class="stat-label">Catalog Value</div><div class="stat-val"><span>$</span>${(totalVal/1000).toFixed(0)}K</div><div class="stat-delta up">â†‘ ${products.length} products</div></div>
    <div class="stat-card green"><div class="stat-label">Firebase Revenue</div><div class="stat-val"><span>$</span>${revenue.toLocaleString()}</div><div class="stat-delta up">${liveOrders.length} orders</div></div>
    <div class="stat-card blue"><div class="stat-label">Avg Conversion Rate</div><div class="stat-val">3<span>.8%</span></div><div class="stat-delta up">â†‘ Industry avg: 1.7%</div></div>
    <div class="stat-card orange"><div class="stat-label">Cart Abandonment</div><div class="stat-val">64<span>%</span></div><div class="stat-delta dn">Industry avg: 70%</div></div>`;
  const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],revs=[38,52,44,71,68,82,77,95,88,103,91,118],maxR=Math.max(...revs);
  document.getElementById('bigChart').innerHTML=months.map((m,i)=>`<div class="big-bar-wrap"><div class="big-bar" style="height:${(revs[i]/maxR)*200}px;background:${i===11?'var(--gold)':'rgba(212,175,55,.4)'}" data-tip="$${revs[i]}K"></div><div class="big-lbl">${m}</div></div>`).join('');
  const cats=['Rings','Watches','Necklaces','Bracelets','Earrings'],colors=['#D4AF37','#3498db','#2ecc71','#e67e22','#9b59b6'];
  const catVals=cats.map(c=>products.filter(p=>p.cat===c).reduce((s,p)=>s+p.num,0));
  const grand=catVals.reduce((a,b)=>a+b,0),catPcts=catVals.map(v=>Math.round(v/grand*100));
  let offset=0;const R=52,C=2*Math.PI*R;
  const slices=catPcts.map((pct,i)=>{const dash=C*pct/100,gap=C-dash,sl=`<circle cx="70" cy="70" r="${R}" fill="none" stroke="${colors[i]}" stroke-width="16" stroke-dasharray="${dash} ${gap}" stroke-dashoffset="${-offset}"/>`;offset+=dash;return sl;});
  const topCat=cats[catPcts.indexOf(Math.max(...catPcts))];
  document.getElementById('donutWrap').innerHTML=`<div class="donut"><svg viewBox="0 0 140 140" width="140" height="140">${slices.join('')}</svg><div class="donut-label"><div class="donut-pct">${Math.max(...catPcts)}%</div><div class="donut-sub">${topCat}</div></div></div><div class="donut-legend">${cats.map((c,i)=>`<div class="legend-row"><div class="legend-dot" style="background:${colors[i]}"></div><div class="legend-name">${c}</div><div class="legend-val">${catPcts[i]}%</div></div>`).join('')}</div>`;
  document.getElementById('kpiGrid').innerHTML=[
    {label:'Avg Order Value',val:'$'+avgPrice.toLocaleString(),trend:'â†‘ Catalog avg',up:true},
    {label:'Price Range',val:'$'+minPrice.toLocaleString()+' â€“ $'+maxPrice.toLocaleString(),trend:'All categories',up:true},
    {label:'On-Sale Products',val:products.filter(p=>p.badge==='sale').length+'',trend:Math.round(products.filter(p=>p.badge==='sale').length/products.length*100)+'% of catalog',up:false},
    {label:'New Arrivals',val:products.filter(p=>p.badge==='new').length+'',trend:'This season',up:true},
    {label:'Limited Stock',val:products.filter(p=>p.stock).length+'',trend:'Urgency triggers',up:true},
    {label:'Firebase Orders',val:liveOrders.length+'',trend:'$'+liveOrders.reduce((s,o)=>s+(o.total||0),0).toLocaleString()+' revenue',up:true},
  ].map(k=>`<div class="kpi"><div class="kpi-label">${k.label}</div><div class="kpi-val">${k.val}</div><div class="kpi-trend" style="color:${k.up?'var(--green)':'var(--muted)'}">${k.trend}</div></div>`).join('');
  document.getElementById('priceDistChart').innerHTML=cats.map((cat,ci)=>{const ps=products.filter(p=>p.cat===cat);const avg2=Math.round(ps.reduce((s,p)=>s+p.num,0)/ps.length);const w=Math.round(avg2/maxPrice*100);return`<div class="cat-row"><div class="cat-name">${cat}</div><div class="cat-bar-wrap"><div class="cat-bar" style="width:${w}%;background:${colors[ci]}"></div></div><div class="cat-pct" style="color:${colors[ci]}">$${avg2.toLocaleString()}</div></div>`;}).join('');
}

// MOBILE SIDEBAR
function toggleSidebar(){const sb=document.getElementById('adminSidebar'),ov=document.getElementById('sOverlay'),open=sb.classList.toggle('mob-open');ov.classList.toggle('open',open);}
function closeSidebar(){document.getElementById('adminSidebar').classList.remove('mob-open');document.getElementById('sOverlay').classList.remove('open');}

document.getElementById('orderModal').addEventListener('click',function(e){if(e.target===this)closeOrderModal();});
document.getElementById('custModal').addEventListener('click',function(e){if(e.target===this)closeCustModal();});

function checkMobile(){const btn=document.getElementById('mobMenuBtn');if(btn)btn.style.display=window.innerWidth<=900?'flex':'none';}
window.addEventListener('resize',checkMobile);checkMobile();
</script>
</body>
</html>